pipeline {
  agent {
    docker { image 'liquibase/liquibase:latest' }
  }
  stages {
  stage('status') {
    when {
        expression {
            return env.ACTION == 'status';
        }
    }
    steps {
           sh 'liquibase status --changeLogFile=db.changelog-master.xml'
    }  
  }
  stage('tag') {
    when {
        expression {
            return env.ACTION == 'update';
        }
    }
    steps {
             sh 'liquibase tag ${BUILD_NUMBER}'
    }
  }
  stage('update') {
    when {
        expression {
            return env.ACTION == 'update';
        }
    }
    steps {
           sh 'liquibase update --changeLogFile=db.changelog-master.xml'
    }  

}
  stage('rollback') {
    when {
        expression {
            return env.ACTION == 'rollback';
        }
    }
    steps {
           sh 'liquibase rollback ${VERSION}'
    }  
    
} 
  }
  post {
    always {
      cleanWs()
    }
  }

}
